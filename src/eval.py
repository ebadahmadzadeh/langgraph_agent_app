"""loads the output json files for each patient generated by the clinical_judge_skill
and computes statistics about the accuracy and hall ucination rates for both the
recommended treatment and the clinical summary."""

import os
import json


OUTPUT_BASE_PATH = "/Users/ebadahmadzadeh/ms-code-projects/ethermed/langgraph_agent_app/outputs"

def analyze_clinical_judge_outputs(patient_id_list: list[int]) -> None:
    """Analyzes the outputs of the clinical_judge_skill for the given patient IDs."""
    total_patients = len(patient_id_list)
    treatment_exact_match_count = 0
    summary_exact_match_count = 0

    for patient_id in patient_id_list:
        treatment_fp = os.path.join(
            OUTPUT_BASE_PATH, f"pid{patient_id:04d}_treatment_recommendation.json")
        summary_fp = os.path.join(
            OUTPUT_BASE_PATH, f"pid{patient_id:04d}_clinical_summary.json")

        # check if the file exists before loading
        if os.path.exists(treatment_fp):
            treatment_data = json.load(open(treatment_fp, 'r'))
        else:
            print(f"Warning: Treatment recommendation file not found for patient {patient_id}")

        if os.path.exists(summary_fp):
            summary_data = json.load(open(summary_fp, 'r'))
        else:
            print(f"Warning: Clinical summary file not found for patient {patient_id}")
        

        

    treatment_accuracy = (treatment_exact_match_count / total_patients) * 100
    summary_accuracy = (summary_exact_match_count / total_patients) * 100

    print(f"Treatment Recommendation Exact Match Accuracy: {treatment_accuracy:.2f}%")
    print(f"Clinical Summary Exact Match Accuracy: {summary_accuracy:.2f}%")